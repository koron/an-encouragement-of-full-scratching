= フルスクラッチ自作キーボードファームウェア: C言語でRP2040のプログラムを書く方法
MURAOKA Taro (KoRoN, @kaoriya)
2022/12/31 発行
:source-highlighter: rouge
//:toc: right
:figure-caption: 図

<<<

## なぜフルスクラッチするのか

自作キーボードのファームウェアといえばQMKをはじめとして、いくつものオープンソースソフトウェアが既に存在しています。それにも関わらず、なぜファームウェアをフルスクラッチで自作する必要があるのでしょうか? それはRP2040のC言語用SDKがとてもよくできており、簡単にUSBキーボードを作れてしまうからです。またその過程で典型的な組込み機器用のプログラムの書き方が学べてしまいます。ならばやるしかないですね。

## 作例紹介

そうやって実際にできたものが https://github.com/koron/yuiop60pi です。このファームウェアはフルスクラッチでPICO SDK(RP2040のC言語用SDK)のみで作成されています。このファームウェアはキーボードファームウェアとして共通ライブラリDIYKBと、YUIOP60Piという自作キーボード固有のコードの2つで構成されています。以下ではポイントとなるところを見ていきましょう。

YUIOP60Piは https://github.com/koron/yuiop60pi/tree/v0.3/yuiop60pi[yuiop60pi/] ディレクトリ内に存在する、以下のたった6つのファイルからできています。それぞれのファイルの役割は次のようになります。

CMakeList.txt::
ビルドの仕方などの情報
config.h::
USB上での識別名などの設定ファイル
keymap.c::
キーマップの設定ファイル
layout.c::
キーマトリックスのスキャン方法とキーレイアウトの設定ファイル
main.c::
ファームウェアのエントリポイント
tusb_config.h::
USBの設定ファイル。通常は変更する必要が無い
